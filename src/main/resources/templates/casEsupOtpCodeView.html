<!DOCTYPE html>
<html layout:decorator="layout">
    <head th:inline="text">
            <title th:utext="#{cas.mfa.esupotp.pagetitle}"></title>
    </head>

    <body id="cas">
        <div layout:fragment="content">
            <div class="box fl-panel" id="login">
                <form method="post" id="fm1" class="fm-v clearfix" th:object="${credential}">
                    <div id="msg" class="errors" th:if="${#fields.hasErrors('*')}">
                        <span th:each="err : ${#fields.errors('*')}" th:utext="${err}"/>
                    </div>

                    <div class="row fl-controls-left">
                        <label for="token" class="fl-label" th:utext="#{cas.mfa.esupotp.password}"/>

                        <input type="text" class="required" id="token" size="25" tabindex="1"
                               th:field="*{token}"
                               th:accesskey="#{screen.welcome.label.password.accesskey}" autocomplete="off"/>
                        <input class="btn-submit btn-block" name="_eventId_submit" accesskey="l"
                               th:value="#{screen.welcome.button.login}" tabindex="4" type="submit" style="margin-top: 15px;"/>
                    </div>

                    <input type="hidden" name="execution" th:value="${flowExecutionKey}"/>
                </form>

                <div id="codeRequest" th:data-url="${flowExecutionKey}"></div>
            </div>
            <script type="text/javascript">
                $(document).ready(function() {
                    //on load
                    var $outputDiv = $('#codeRequest');
                    var eventId = "callTransportView";
                    
                    $.ajax({
                        type: "POST",
                        data: {execution:$("#codeRequest").data('url')}  ,
                        url: "?_eventId="+eventId+"&ajaxSource=true"
                    }).done(function(data){
                        $outputDiv.html(data);
                    }).fail(function(error){
                        $outputDiv.html(error);
                    });
                    
                    // submit transport choice
                    $(document).on('click', 'input.transportInput', function(){
                        var $outputDiv = $('#transportStatus');
                        var eventId = "submitCallTransport";
                        $.ajax({
                            type: "POST",
                            data: $("#fm2").serialize(),
                            url: "?_eventId="+eventId+"&ajaxSource=true"
                        }).done(function(data){
                            $outputDiv.html(data);
                        }).fail(function(error){
                            $outputDiv.html(error);
                        });
                    });
                });
            </script>
        </div>
    </body>
</html>